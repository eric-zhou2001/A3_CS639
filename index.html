<!-- This example is from Alan Villalobos-->
<!DOCTYPE html>

  <head>
    <link rel='stylesheet' href="./styles.css">
    <title>Fast-Food Distribution</title>
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-composite-projections/1.0.2/d3-composite-projections.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>
    <h1 style='text-align:center;'>Fast-Food Distribution Across the USA</h1>
    <div class="flex-container">
      <!--This is where the map is loaded in-->
      <div id="map"></div>
      <div class="filter-container">
        <h2>Filter</h2>
        <div class="select-container">
          <h3>Select Fastfood Restaurant</h3>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="arby-select" name="arby-select" value="Arby's">
          <label for="arby-select">Arby's</label><div class="circle" style='background:red;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="bk-select" name="bk-select" value="Burger King">
          <label for="bk-select">Burger King</label><div class="circle" style='background:orange;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id='dq-select' name='dq-select' value='Dairy Queen'>
          <label for='dq-select'>Dairy Queen</label><div class="circle" style='background:blue;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="dp-select" name="dp-select" value="Domino's Pizza">
          <label for="dp-select">Domino's Pizza</label><div class="circle" style='background:white;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="jitb-select" name="jitb-select" value="Jack in the Box">
          <label for="jitb-select">Jack in the Box</label><div class="circle" style='background:pink;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="mcdonald-select" name="mcdonald-select" value="McDonald's">
          <label for="mcdonald-select">McDonald's</label><div class="circle" style='background:yellow;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="pizzahut-select" name="pizzahut-select" value="Pizza Hut">
          <label for="pizzahut-select">Pizza Hut</label><div class="circle" style='background:brown;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="subway-select" name="subway-select" value="Subway">
          <label for="subway-select">Subway</label><div class="circle" style='background:green;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="tb-select" name="tb-select" value="Taco Bell">
          <label for="tb-select">Taco Bell</label><div class="circle" style='background:purple;'></div><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' class='restaurant-select' id="wendy-select" name="wendy-select" value="Wendy's">
          <label for="wendy-select">Wendy's</label><div class="circle" style='background:aqua;'></div><br>
          <button onclick='resetRestaurants()' class='reset-btn'>Reset</button>
        </div>
        <div style="margin-bottom: 1em;" class="select-container">
          <h2>Select State</h2>
          <h3>State 1:</h3>
          <select onchange="toggleState(this,0);" onfocus="this.selectedIndex = -1;">
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>				
          <button onclick='resetStates(0)' class='reset-btn'>Reset</button>
          <h3>State 2:</h3>
          <select onchange="toggleState(this,1);" onfocus="this.selectedIndex = -1;">
            <option value="AL">Alabama</option>
            <option value="AK">Alaska</option>
            <option value="AZ">Arizona</option>
            <option value="AR">Arkansas</option>
            <option value="CA">California</option>
            <option value="CO">Colorado</option>
            <option value="CT">Connecticut</option>
            <option value="DE">Delaware</option>
            <option value="FL">Florida</option>
            <option value="GA">Georgia</option>
            <option value="HI">Hawaii</option>
            <option value="ID">Idaho</option>
            <option value="IL">Illinois</option>
            <option value="IN">Indiana</option>
            <option value="IA">Iowa</option>
            <option value="KS">Kansas</option>
            <option value="KY">Kentucky</option>
            <option value="LA">Louisiana</option>
            <option value="ME">Maine</option>
            <option value="MD">Maryland</option>
            <option value="MA">Massachusetts</option>
            <option value="MI">Michigan</option>
            <option value="MN">Minnesota</option>
            <option value="MS">Mississippi</option>
            <option value="MO">Missouri</option>
            <option value="MT">Montana</option>
            <option value="NE">Nebraska</option>
            <option value="NV">Nevada</option>
            <option value="NH">New Hampshire</option>
            <option value="NJ">New Jersey</option>
            <option value="NM">New Mexico</option>
            <option value="NY">New York</option>
            <option value="NC">North Carolina</option>
            <option value="ND">North Dakota</option>
            <option value="OH">Ohio</option>
            <option value="OK">Oklahoma</option>
            <option value="OR">Oregon</option>
            <option value="PA">Pennsylvania</option>
            <option value="RI">Rhode Island</option>
            <option value="SC">South Carolina</option>
            <option value="SD">South Dakota</option>
            <option value="TN">Tennessee</option>
            <option value="TX">Texas</option>
            <option value="UT">Utah</option>
            <option value="VT">Vermont</option>
            <option value="VA">Virginia</option>
            <option value="WA">Washington</option>
            <option value="WV">West Virginia</option>
            <option value="WI">Wisconsin</option>
            <option value="WY">Wyoming</option>
          </select>				
          <button onclick='resetStates(1)' class='reset-btn'>Reset</button>
        </div>
      </div>
    </div>

    <!--Standard HTML-->
    <div class="flex-container">
      <div class='background-container'>
        <h2>Background and Motivations</h3>
        <p>Fast-food has exploded in popularity throughout the US. Popular chains like McDonald, Sonic, and Burger King have seemingly expanded their reach through every state. However, certain fast-food restaurants only appear in specific regions. One example of this is Culvers, a popular Midwestern burger joint which does not appear in the Northeast. Another example is In-N-Out, which dominates the West. We want to better understand how this distribution changes depending on their region. </p>
        <p>Using a map is the most effective visualization method for displaying geographic data. Thus, it is a natural choice for displaying the locations of each fast-food chain in the United States. The user will also be able to include and exclude each chain from the map so that they can more easily compare geographic data between individual restaurants.</p>
        <p>Select different states by either clicking on them or using the menu! Additionally, filter out for your favorite restaurant by using the other menu.</p>
      </div>
    </div>

    <!--This is the D3 part-->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-composite-projections/1.0.2/d3-composite-projections.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript">
      var restaurants = [];
      $(document).ready(() => {
        // check if checkboxes are active from previous state
        $('.restaurant-select:checkbox').map((i, d) => {
          if ($(d).is(':checked')) {
            toggleRestaurant(d); // send jquery element
          }
          toggleOpacity(d);
        });
      });
      // hash maps for easy lookup/intuitive mapping for state numbers and names
      stateNumMap = {
        "AL":1,
        "AK":2,
        "AZ":4,
        "AR":5,
        "CA":6,
        "CO":8,
        "CT":9,
        "DE":10,
        "FL":12,
        "GA":13,
        "HI":15,
        "ID":16,
        "IL":17,
        "IN":18,
        "IA":19,
        "KS":20,
        "KY":21,
        "LA":22,
        "ME":23,
        "MD":24,
        "MA":25,
        "MI":26,
        "MN":27,
        "MS":28,
        "MO":29,
        "MT":30,
        "NE":31,
        "NV":32,
        "NH":33,
        "NJ":34,
        "NM":35,
        "NY":36,
        "NC":37,
        "ND":38,
        "OH":39,
        "OK":40,
        "OR":41,
        "PA":42,
        "RI":44,
        "SC":45,
        "SD":46,
        "TN":47,
        "TX":48,
        "UT":49,
        "VT":50,
        "VA":51,
        "WA":53,
        "WV":54,
        "WI":55,
        "WY":56
      }

      // Massive inspiration from this video: https://www.youtube.com/watch?v=G-VggTK-Wlg
      var width = 950, height = 500;
      var svg = d3.select('#map')
          .append('svg')
          .attr("width",width)
          .attr("height",height)
          .append("g");
      var projection = d3.geoAlbersUsa()
        .translate([ width / 2, height / 2])
        .scale(800); // Can change this depending on how zoomed we want the map
      d3.json("us.json", (err, data) => {
        var path = d3.geoPath()
          .projection(projection);
        var states = topojson.feature(data, data.objects.states).features
        svg.selectAll(".state")
          .data(states)
          .enter()
          .append("path")
          .attr("class", data => {
            return `state`; // Maybe do stuff state dependent? That's a little hard
          })
          .attr('id', data => {
            return data.id;
          })
          .on("mouseenter", data => {
            $(`#${data.id}`).addClass('highlight-border-state');
          })
          .on('mouseleave', data => {
            $(`#${data.id}`).removeClass('highlight-border-state');
          })
          .on('click', data => {
            // do some fun stuff here where we select all things in this state
            if ($('.clicked').length) {
              $('.clicked').removeClass('clicked');
            }
            $(`#${data.id}`).removeClass('highlight-border-state').addClass('clicked');
          })
          .attr("d", path);
      });
      // Now, we can plot the actual fast food restaurants themselves.
      d3.csv('./cleaned_rstrnts.csv', (err, data) => {
        svg.selectAll('.restaurant')
          .data(data)
          .enter()
          .append('circle')
          .attr('class', d => {
            return `restaurant ${d.name.replaceAll(' ', '').replaceAll('\'', '')} ${d.Division.replaceAll(' ', '')} ${d["State Code"]}`;
          })
          .attr('r', 2)
          .attr('cx', d => {
            var coords = projection([d.longitude, d.latitude])
            return coords[0]
          })
          .attr('cy', d => {
            var coords = projection([d.longitude, d.latitude])
            return coords[1]
          });
      });

      // Actual JavaScript/non-D3 stuff
      // Restaurant helper functions
      function toggleRestaurant(restaurant) {
        restaurant = $(restaurant);
        //.is(":checked") is used to check for the checkbox state
        // .val() is to check for the value of the checkbox
        if (restaurant.is(":checked")) {
          restaurants.push(restaurant.val());
          // make all the restaurants NOT in the restaurant array opacity less
        } else {
          var last = restaurants.pop(restaurant.val());
        }
        toggleOpacity();
      }

      function resetRestaurants() {
          // go into class and reset all that are not selected
          $(':checkbox').map((i, d) => {
            $(d).prop('checked', false)
          });
          restaurants = [];
          toggleOpacity();
      }

      // Adds opacity class
      function toggleOpacity() {
        const restaurantMark = $(".restaurant").toArray();
        if (states[0] || states[1]) {
          // Change color of states
          $(".state").toArray().forEach(s => {
            s = $(s);
            s.addClass('opacity-empty');
            s.removeClass('opacity-full');
          });
          if (states[0]) {
            $(`#${stateNumMap[states[0]]}`).addClass('opacity-full').removeClass('opacity-empty');
          }
          if (states[1]) {
            $(`#${stateNumMap[states[1]]}`).addClass('opacity-full').removeClass('opacity-empty');
          }
        } else {
          $(".state").toArray().forEach(s => {
            s = $(s);
            s.removeClass('opacity-empty');
            s.addClass('opacity-full');
          });
        }
        
        restaurantMark.forEach(mark => {
          var storedRestaurant = false;
          mark = $(mark);
          restaurants.forEach(rest => {
            // Add depending if stored restaurant is stored in array, and if it's within the state we want.
            if (mark.hasClass(rest.replaceAll('\'', '').replaceAll(' ', ''))) {
              if (states[0] || states[1]) {
                if (states[0] && mark.attr('class').split(' ')[3] == states[0]) {
                  storedRestaurant = true;
                } else if (states[1] && mark.attr('class').split(' ')[3] == states[1]) {
                  storedRestaurant = true;
                }
              } else {
                storedRestaurant = true;
              }
            }
          });
          if (!storedRestaurant) {
            mark.addClass('opacity-empty');
            mark.removeClass('opacity-full');
          } else {
            mark.removeClass('opacity-empty');
            mark.addClass('opacity-full');
          }
        });
      }

      // State helper functions
      var states = [undefined, undefined];
      function toggleState(e, i) {
        var select = $(e);
        states[i] = select.find(":selected").val();
        if (states[0] && states[1] && states[0] === states[1]) {
          alert("Please select two different states!");
        } else {
          // Toggle opacity of states
          // Toggle opacity of restaurants in the toggleOpacity method
          toggleOpacity();
        }
      }

      function resetStates(i) {
        states[i] = undefined;
        toggleOpacity();
      }
    </script>
  </body>
</html>