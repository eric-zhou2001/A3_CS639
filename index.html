<!-- This example is from Alan Villalobos-->
<!DOCTYPE html>

  <head>
    <link rel='stylesheet' href="./styles.css">
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-composite-projections/1.0.2/d3-composite-projections.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  </head>

  <body>
    <h1 style='text-align:center;'>Fast-Food Distribution Across the USA</h1>
    <div class="flex-container">
      <!--This is where the map is loaded in-->
      <div id="map"></div>
      <div class="filter-container">
        <h2>Filter</h2>
        <div class="select-container">
          <h3>Select Fastfood Restaurant</h3>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="arby-select" name="arby-select" value="Arby's">
          <label for="arby-select">Arby's</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="bk-select" name="bk-select" value="Burger King">
          <label for="bk-select">Burger King</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id='dq-select' name='dq-select' value='Dairy Queen'>
          <label for='dq-select'>Dairy Queen</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="dp-select" name="dp-select" value="Domino's Pizza">
          <label for="dp-select">Domino's Pizza</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="jitb-select" name="jitb-select" value="Jack in the Box">
          <label for="jitb-select">Jack in the Box</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="arby-select" name="arby-select" value="Arby">
          <label for="arby-select">Arby's</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="mcdonald-select" name="mcdonald-select" value="McDonald's">
          <label for="mcdonald-select">McDonald's</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="pizzahut-select" name="pizzahut-select" value="Pizza Hut">
          <label for="pizzahut-select">Pizza Hut</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="subway-select" name="subway-select" value="Subway">
          <label for="subway-select">Subway</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="tb-select" name="tb-select" value="Taco Bell">
          <label for="tb-select">Taco Bell</label><br>
          <input type="checkbox" onclick='toggleRestaurant(this)' id="wendy-select" name="wendy-select" value="Wendy's">
          <label for="wendy-select">Wendy's</label><br>
          <button onclick='resetRestaurants()' class='reset-btn'>Reset</button>
        </div>
        <div class="select-container">
          <h3>Select State</h3>
          <select name='Select State' id='select-state'>
            <option value='all the states'>States</option>
          </select>
          <button class='reset-btn'>Reset</button>
        </div>
      </div>
    </div>

    <!--Standard HTML-->
    <div class="flex-container">
      <div class='background-container'>
        <h2>Background and Motivations</h3>
        <p>Fast-food has exploded in popularity throughout the US. Popular chains like McDonald, Sonic, and Burger King have seemingly expanded their reach through every state. However, certain fast-food restaurants only appear in specific regions. One example of this is Culvers, a popular Midwestern burger joint which does not appear in the Northeast. Another example is In-N-Out, which dominates the West. We want to better understand how this distribution changes depending on their region. </p>
        <p>Using a map is the most effective visualization method for displaying geographic data. Thus, it is a natural choice for displaying the locations of each fast-food chain in the United States. The user will also be able to include and exclude each chain from the map so that they can more easily compare geographic data between individual restaurants.</p>
        <p>Select different states by either clicking on them or using the menu! Additionally, filter out for your favorite restaurant by using the other menu.</p>
      </div>
    </div>

    <!--This is the D3 part-->
    <script src="https://d3js.org/d3.v4.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/d3-composite-projections/1.0.2/d3-composite-projections.min.js"></script>
    <script src="https://d3js.org/topojson.v1.min.js"></script>
    <script type="text/javascript">
      var restaurants = [];
      $(document).ready(() => {
        // check if checkboxes are active from previous state
        $(':checkbox').map((i, d) => {
          if ($(d).is(':checked')) {
            toggleRestaurant(d); // send jquery element
          }
          toggleOpacity(d);
        });
      });
      // Massive inspiration from this video: https://www.youtube.com/watch?v=G-VggTK-Wlg
      var width = 950, height = 500;
      var svg = d3.select('#map')
          .append('svg')
          .attr("width",width)
          .attr("height",height)
          .append("g");
      var projection = d3.geoAlbersUsa()
        .translate([ width / 2, height / 2])
        .scale(800); // Can change this depending on how zoomed we want the map
      d3.json("us.json", (err, data) => {
        var path = d3.geoPath()
          .projection(projection);
        var states = topojson.feature(data, data.objects.states).features
        svg.selectAll(".state")
          .data(states)
          .enter()
          .append("path")
          .attr("class", data => {
            return `state`; // Maybe do stuff state dependent? That's a little hard
          })
          .attr('id', data => {
            return data.id;
          })
          .on("mouseenter", data => {
            $(`#${data.id}`).addClass('highlight-border-state');
          })
          .on('mouseleave', data => {
            $(`#${data.id}`).removeClass('highlight-border-state');
          })
          .on('click', data => {
            // do some fun stuff here where we select all things in this state
            if ($('.clicked').length) {
              $('.clicked').removeClass('clicked');
            }
            $(`#${data.id}`).removeClass('highlight-border-state').addClass('clicked');
          })
          .attr("d", path);
      });
      // Now, we can plot the actual fast food restaurants themselves.
      d3.csv('./cleaned_rstrnts.csv', (err, data) => {
        svg.selectAll('.restaurant')
          .data(data)
          .enter()
          .append('circle')
          .attr('class', d => {
            return `restaurant ${d.name.replaceAll(' ', '').replaceAll('\'', '')} ${d.Division.replaceAll(' ', '')}`;
          })
          .attr('r', 2)
          .attr('cx', d => {
            var coords = projection([d.longitude, d.latitude])
            return coords[0]
          })
          .attr('cy', d => {
            var coords = projection([d.longitude, d.latitude])
            return coords[1]
          });
      });

      // Actual JavaScript/non-D3 stuff
      // Restaurant helper functions
      function toggleRestaurant(restaurant) {
        restaurant = $(restaurant);
        //.is(":checked") is used to check for the checkbox state
        // .val() is to check for the value of the checkbox
        if (restaurant.is(":checked")) {
          restaurants.push(restaurant.val());
          // make all the restaurants NOT in the restaurant array opacity less
        } else {
          var last = restaurants.pop(restaurant.val());
          if (restaurants) {
            // Just make the last popped one disappear
          } else {
            // make all restaurants appear
          }
        }
      }

      function resetRestaurants() {
          // go into class and reset all that are not selected
          $(':checkbox').map((i, d) => {
            $(d).prop('checked', false)
          });
          restaurants = [];
      }

      // Pass in element
      function toggleOpacity(e) {
        e = $(e); // convert standard DOM to JQuery
        if (e.is(':checked')) {
          // need to add opacity to the dots rather than the JQUERY element
          e.addClass('opacity');
        } else {
          e.removeClass('opacity');
        }
      }
    </script>
  </body>
</html>